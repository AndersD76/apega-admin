[phases.setup]
nixPkgs = ["nodejs_20"]

[phases.install]
cmds = [
  "cd apega-mobile && npm install",
  "cd apega-backend && npm install"
]

[phases.build]
cmds = [
  "mkdir -p /tmp/static-pages && cp apega-backend/public/*.html /tmp/static-pages/ 2>/dev/null || true",
  "rm -rf apega-mobile/dist apega-mobile/.expo apega-backend/public",
  "cd apega-mobile && npx expo export --platform web",
  "cp -r apega-mobile/dist apega-backend/public",
  "cp /tmp/static-pages/*.html apega-backend/public/ 2>/dev/null || true"
]

[start]
cmd = "cd apega-backend && node src/server.js"
